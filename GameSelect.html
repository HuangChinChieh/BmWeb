<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BM</title>
    <link rel="shortcut icon" href="images/logo_300.png" />
    <link rel="Bookmark" href="images/logo_300.png" />
    <script type="text/javascript" src="Scripts/MultiLanguage.js"></script>
    <script type="text/javascript" src="Scripts/bignumber.min.js"></script>
    <style>
        .selTitle {
            display: inline-block;
            color: white
        }
        /*   PC端樣式    */
        @media (min-width: 768px) {
            button {
                margin: 0;
                padding: 0;
                border: 1px solid transparent;
                outline: none;
                background-color: transparent;
            }

            .containerBrand {
                height: calc(100vh - 430px);
                display: flex;
                flex-direction: column;
                flex-wrap: nowrap;
                justify-content: center;
                align-items: center;
                min-height: 320px;
            }

            .brand:nth-child(odd) {
                background: url(images/btn-back-gray.png) no-repeat;
                background-size: 250px 60px;
            }

                .brand:nth-child(odd) > button {
                    color: #322b28;
                }

            .brand:nth-child(even) {
                background: url(images/btn-back-black.png) no-repeat;
                background-size: 250px 60px;
            }

                .brand:nth-child(even) > button {
                    color: #fcfcfc;
                }

            .brand {
                width: 250px;
                height: 60px;
                margin-bottom: 40px
            }

                .brand:hover {
                    transform: scale(1.10);
                    animation: brandFocus 4s linear infinite;
                }

                .brand > button {
                    width: 180px;
                    font-size: 24px;
                    line-height: 50px;
                    cursor: pointer;
                    font-family: monospace;
                    margin: 5px 35px;
                }

            @keyframes brandFocus {
                0% {
                    filter: contrast(0.5);
                }

                50% {
                    filter: contrast(1.0);
                }

                100% {
                    filter: contrast(0.5);
                }
            }


            .langSel_container {
                text-align: center;
                height: 40px;
                margin: 10px 10px 10px 40px;
            }

            .langSel {
                margin: 0px 35px 15px 0px;
                background-color: rgba(8, 7, 6, 0.8);
                border: 1px solid #d9c38f;
                width: auto;
                /* height: 50px; */
                color: white;
                font-size: 18px;
            }

                .langSel option {
                    color: white;
                    font-size: 18px;
                }

            .image_1 {
                width: 240px;
                height: 240px;
                margin: 30px 180px 40px 180px;
            }

            .image-wrapper_1 {
                width: 600px;
                max-width: 100vw;
                height: auto;
                margin: auto;
                background-color: rgba(8, 7, 6, 0.8);
                padding: 0px 60px;
                min-height:100vh;
            }
        }

        /*   移動端樣式    */
        @media (max-width: 767px) {
            .selContainer {
                height: 90px;
                display: flex;
                flex-direction: column;
                align-items: center;
                flex-wrap: nowrap;
                justify-content: space-evenly;
            }

            button {
                margin: 0;
                padding: 0;
                border: 1px solid transparent;
                outline: none;
                background-color: transparent;
            }

            .containerBrand {
                height: calc(100vh - 50vw - 90px);
                display: flex;
                flex-direction: column;
                flex-wrap: nowrap;
                justify-content: center;
                align-items: center;
                min-height: 320px;
            }

            .brand:nth-child(odd) {
                background: url(images/btn-back-gray.png) no-repeat;
                background-size: contain;
            }

                .brand:nth-child(odd) > button {
                    color: #322b28;
                }

            .brand:nth-child(even) {
                background: url(images/btn-back-black.png) no-repeat;
                background-size: contain;
            }

                .brand:nth-child(even) > button {
                    color: #fcfcfc;
                }

            .brand {
                width: auto;
                height: auto;
                margin-bottom: 40px
            }

                .brand:hover {
                    transform: scale(1.10);
                    animation: brandFocus 4s linear infinite;
                }

                .brand > button {
                    width: 180px;
                    font-size: 24px;
                    line-height: 45px;
                    cursor: pointer;
                    font-family: Georgia;
                    margin: 10px 40px;
                }

            @keyframes brandFocus {
                0% {
                    filter: contrast(0.5);
                }

                50% {
                    filter: contrast(1.0);
                }

                100% {
                    filter: contrast(0.5);
                }
            }


            .langSel_container {
                text-align: center;
            }

            .langSel {
                background-color: rgba(8, 7, 6, 0.8);
                border: 1px solid #d9c38f;
                width: auto;
                /* height: 50px; */
                color: white;
                font-size: 18px;
            }

                .langSel option {
                    color: white;
                    font-size: 18px;
                }

            .image_1 {
                width: 50%;
                margin: 0 25%;
            }

            .image-wrapper_1 {
                width: 600px;
                max-width: 100vw;
                height: auto;
                margin: auto;
                background-color: rgba(8, 7, 6, 0.8);
                padding: 0px 0px;
                min-height: 100vh;
            }
        }

        .gameContainer {
            width: 100vw;
            height: 100vh;
            position: fixed;
            background-color: black;
            transform: translateY(100vh);
            top: 0;
            transition: transform 0.5s;
        }

        .gameContainer-show {
            transform: translateY(0);
        }

        .game-header {
            height: 40px;
            width: 100%;
            position: relative;
            top: 0px;
            background: linear-gradient(180deg, #CDBB9D 0%, #B9A179 100%, #CDB690 100%);
            justify-content: center;
            display: flex;
            align-items: center;
        }

        .game-back {
            position: absolute;
            left: 0px;
            font-size: 32px;
            font-weight: 900;
            -webkit-text-stroke: 0.1px rgb(232 232 232);
            color: black;
            font-family: emoji;
            border: 0px;
            margin: 0px;
            line-height: 40px;
            width: 60px;
        }


        .game-body {
            width: 100%;
            height: calc(100% - 40px);
            position: relative;
            /* top: 40px;*/
            overflow-y: auto;
            box-sizing: border-box;
            display: flex;
        }

        .game-title {
            line-height: 40px;
            font-family: Microsoft JhengHei;
            position: relative;
            font-size: 18px;
            font-weight: bold;
            color: #373b4e;
        }

        .game-icon {
            height: 24px;
            width: 24px;
            /* vertical-align: middle; */
            top: 5px;
            position: absolute;
            left: -24px
        }

        .game-mask {
            height: 100%;
            width: 100%;
            background-color: black;
            position: absolute;
            top: 0;
        }

        .is-hide {
            display: none;
        }
    </style>
</head>
<body style="background-color: rgb(3 15 36);margin:0px">
    <div class="page flex-col" style="width: 100%; height: 100vh; background: url(images/banner.jpg) 100% repeat; background-size: 100% 100%;overflow-y: auto;">
        <div class="image-wrapper_1 flex-col">
            <img class="image_1"
                 referrerpolicy="no-referrer"
                 src="images/logo_1024.png" />

            <div class="selContainer">
                <div class="langSel_container">
                    <div class="selTitle language_replace">錢包：</div>
                    <select id="idCurrencySel" class="langSel" onchange="currencySelChange(event)">
                        <!--<option value="CNY" selected>CNY</option>
                        <option value="PUSD">PUSD</option>
                        <option value="CUSD">CUSD</option>
                        <option value="KRW">KRW</option>
                        <option value="PHP">PHP</option>
                        <option value="HKD">HKD</option>-->
                    </select>
                </div>
                <div class="langSel_container">
                    <div class="selTitle language_replace">語系：</div>
                    <select id="idlangSel" class="langSel" onchange="langSelChange(event)">
                        <option value="ENG" selected>English</option>
                        <option value="CHS">简体中文</option>
                        <option value="JPN">日本語</option>
                        <option value="KOR">한국어</option>
                        <option value="CHT">繁體中文</option>
                    </select>
                </div>
            </div>
            <div class="containerBrand">
                <div onclick="clickEntryGame('BM')" class="brand">
                    <button class="language_replace">BM 電投</button>
                </div>
                <div onclick="clickEntryGame('PS')" class="brand">
                    <button class="language_replace">BM 體育</button>
                </div>
                <div onclick="clickEntryGame('DBES')" class="brand">
                    <button class="language_replace">BM 電競</button>
                </div>
            </div>
        </div>
    </div>
    <div id="idGameContainer" class="gameContainer">
        <div class="game-header">
            <button class="game-back" onclick="leaveGame();">↩︎</button>
            <img class="game-icon" src="images/logo_300.png" /><span class="game-title">電子競技</span>
        </div>
        <div class="game-body">
            <iframe id="idGameFrame" src="" style="height:100%;width:100%;border:0px"></iframe>
        </div>
        <div class="game-mask"></div>
    </div>

    <script type="text/javascript" src="/Scripts/Common.js"></script>
    <script type="text/javascript" src="/Scripts/LobbyAPI.js"></script>
    <script type="text/javascript" src="/Scripts/Math.uuid.js"></script>
    <!--<script type="text/javascript" src="Scripts/MultiLanguage.js"></script>-->
    <script type="text/javascript">
        var c = new common();
        var SID;
        var CT;
        var CurrencyType;
        var Lang;
        var mlp;
        var p;
        var WalletInfo;
        var gameFrameOpened = false;
        /*  var mlp;*/

        function clickEntryGame(brand) {
            cb = () => {
                var Url = "GameRedirect.aspx?CT=" + encodeURIComponent(CT) + "&SelectGameBrand=" + brand + "&CurrencyType=" + CurrencyType;
                var gameTitle = "";

                if (Lang) {
                    Url += "&Lang=" + Lang;
                }


                switch (brand) {
                    case "BM":
                        gameTitle = mlp.getLanguageKey("電投");
                        break;

                    case "DBES":
                        gameTitle = mlp.getLanguageKey("電子競技");
                        break;
                    case "PS":
                        gameTitle = mlp.getLanguageKey("體育");
                        break;
                    default:
                        gameTitle = "BM";
                        break;
                }

                document.querySelector(".game-title").innerText = gameTitle;
                document.querySelector(".game-mask").classList.add("is-hide");
                document.getElementById("idGameContainer").classList.add("gameContainer-show");
                document.getElementById("idGameFrame").src = Url;
                gameFrameOpened = true;
            };

            if (CurrencyType) {
                cb();
            } else {

            }
        }

        function leaveGame() {
            document.getElementById("idGameContainer").classList.remove("gameContainer-show");
            document.getElementById("idGameFrame").src = "";
            gameFrameOpened = false;

            p.ReceiveGamePointByProduct(CT, "", Math.uuid(), (success, o) => {
                p.GetUserInfoByProduct(CT, Math.uuid(), (success, o) => {
                    if (success == true) {
                        if (o.Result == 0) {
                            WalletInfo = o;
                            updateBaseInfo();
                        }
                    }
                });
            });
        }

        function updateBaseInfo() {
            if (WalletInfo) {
                var MaxCurrency;
                var MaxPointValue = 0;
                var CurrencyTypeInList = false;

                idCurrencySel.innerHTML = "";

                for (var i = 0; i < WalletInfo.WalletList.length; i++) {
                    var wallet = WalletInfo.WalletList[i];
                    var opt = document.createElement("option");
                    opt.value = wallet.CurrencyType;
                    opt.innerText = wallet.CurrencyType + "  " + new BigNumber(wallet.PointValue).toFormat();

                    if (wallet.PointValue > MaxPointValue) {
                        MaxCurrency = wallet.CurrencyType;
                        MaxPointValue = wallet.PointValue;
                    }

                    if (CurrencyType) {
                        if (CurrencyTypeInList == false) {
                            CurrencyTypeInList = MaxCurrency == CurrencyType;
                        }
                    }

                    idCurrencySel.appendChild(opt);
                }

                if (CurrencyTypeInList) {
                    idCurrencySel.value = CurrencyType;
                } else {
                    if (MaxCurrency) {
                        CurrencyType = MaxCurrency;
                        idCurrencySel.value = MaxCurrency;
                    }
                }
            }
        }

        function init() {
            CT = c.getParameter("CT");
            Lang = c.getParameter("Lang");
            CurrencyType = c.getParameter("CurrencyType");


            p = new LobbyAPI("/API/LobbyAPI.asmx");

            if (!CT) {
                window.location.href = "index.aspx";
            } else {
                CT = decodeURIComponent(CT)
            }

            var guid = Math.uuid();

            p.GetUserInfoByProduct(CT, guid, (success, o) => {
                if (success == true) {
                    if (o.Result == 0) {
                        WalletInfo = o;
                        updateBaseInfo();
                    }
                }
            });

            if (Lang) {
                idlangSel.value = Lang;
            } else {
                if (window.localStorage.getItem("Lang")) {
                    Lang = window.localStorage.getItem("Lang");
                }

                if (!Lang) {
                    Lang = "ENG";
                }
            }



            //mlp = new multiLanguage();

            //setLanguage(Lang, function () {

            //    //initLiveChat();
            //});


            document.getElementById("idGameContainer").addEventListener("transitionend", () => {
                // 过渡完成后执行的代码
                if (gameFrameOpened == false) {
                    document.querySelector(".game-mask").classList.add("is-hide");
                }
            });

            frameResize();

            mlp = new multiLanguage();

            setLanguage(Lang, function () { });

            window.setInterval(function () {
                // refresh SID and Token;
                var guid = Math.uuid();

                p.KeepSIDByProduct(CT, guid, function (success, o) {
                    if (success == true) {
                        if (o.Result != 0) {
                            window.location.href = "index.aspx";
                        }
                    } else {
                        window.location.href = "index.aspx";
                    }
                });

            }, 10000);
        }

        function currencySelChange(e) {
            var sel = e.currentTarget;
            CurrencyType = sel.value;
            //setLanguage(lang);
        }

        function langSelChange(e) {
            var sel = e.currentTarget;
            Lang = sel.value;


            setLanguage(Lang, null);
            //setLanguage(lang);
        }

        function setLanguage(c, cb) {
            Lang = c;

            window.localStorage.setItem("Lang", Lang);
            idlangSel.value = Lang;

            mlp.loadLanguage(Lang, function () {
                if (cb)
                    cb();
            });
        }

        function frameResize() {
            if (gameFrameOpened == true) {
                var frame = document.getElementById("idGameFrame");

                frame.style.height = frame.contentWindow.outerHeight + "px";
                frame.style.width = frame.contentWindow.outerWidth + "px";
            }
        }


        window.onload = init;
        window.onresize = frameResize;

    </script>
</body>
</html>
